from sklearn.ensemble import IsolationForest
import numpy as np

def analyze_state(data, user_input=None):
    # Koulutetaan malli (oikeassa sovelluksessa koulutus tehtäisiin erikseen)
    X = np.array([[data['engine']['temp'], [data['engine']['oil_level']])  # Esimerkkidata
    model = IsolationForest(contamination=0.1).fit(X)
    
    # Ennustetaan häiriö
    anomaly_score = model.predict([[data['engine']['temp'], data['engine']['oil_level']])
    advice = "Häiriö mahdollinen!" if anomaly_score[0] == -1 else "Kaikki ok"
    
    return {"advice": advice, "response": advice}
